version: '3'

services:
  mysql:
    image: mysql:5.7
    container_name: engine.test.mysql
    environment:
      - MYSQL_RANDOM_ROOT_PASSWORD=yes
      - MYSQL_DATABASE=db_test
      - MYSQL_USER=test
      - MYSQL_PASSWORD=test
    ports:
      - "3306:3306"
  pin:
    depends_on: 
      - mysql
    image: python:3
    container_name: engine.test.pin
    volumes:
      - ../../:/var/app
    ports:
      - "8080:8080"
    environment:
      - PIN_DB_CONF=/var/app/pin/tests/pin.conf
    command:
      - sh
      - -c
      - |
        cd /var/app
        pip install -r requirements.txt
        python setup.py install
        cd /var/app/pin/tests
        pip install -r requirements-test.txt
        python -m pytest ut
